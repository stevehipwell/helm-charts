apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ template "clamav.commandsname" . }}
  labels:
    {{- include "clamav.labels" . | nindent 4 }}
data:
  clamdcheck.sh: |
    #!/usr/bin/env sh

    set -eu

    if [ "$(echo "PING" | nc 127.0.0.1 3310)" != "PONG" ]; then
      echo "ERROR: Unable to contact server"
      exit 1
    fi

    echo "Clamd is up"

    exit 0
