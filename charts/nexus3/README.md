# Nexus 3

[Sonatype Nexus 3](https://www.sonatype.com/nexus-repository-oss) is The free artefact repository with universal format support.

## Installing the Chart

Before you can install the chart you will need to add the `stevehipwell` repo to [Helm](https://helm.sh/).

```shell
helm repo add stevehipwell https://stevehipwell.github.io/helm-charts/
```

After you've installed the repo you can install the chart.

```shell
helm upgrade --install --namespace default --values ./my-values.yaml my-release stevehipwell/nexus3
```

## Configuration

The following table lists the configurable parameters of the _Nexus 3_ chart and their default values.

| Parameter                                 | Description                                                                                                                                                                 | Default                              |
| ----------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------ |
| `image.repository`                        | Image repository.                                                                                                                                                           | `sonatype/nexus3`                    |
| `image.tag`                               | Image tag.                                                                                                                                                                  | `.Chart.AppVersion`                  |
| `image.pullPolicy`                        | Image pull policy.                                                                                                                                                          | `IfNotPresent`                       |
| `image.pullSecrets`                       | **DEPRECATED** Image pull secrets, use `imagePullSecrets` instead.                                                                                                          | `[]`                                 |
| `imagePullSecrets`                        | Image pull secrets, will override `image.pullSecrets`.                                                                                                                      | `[]`                                 |
| `nameOverride`                            | Override the name of the chart.                                                                                                                                             |                                      |
| `fullnameOverride`                        | Override the full name of the chart.                                                                                                                                        |                                      |
| `commonLabels`                            | Labels to add to all chart resources.                                                                                                                                       | `{}`                                 |
| `serviceAccount.create`                   | If `true`, create a new service account.                                                                                                                                    | `true`                               |
| `serviceAccount.labels`                   | Labels to add to the service account.                                                                                                                                       | `{}`                                 |
| `serviceAccount.annotations`              | Annotations to add to the service account.                                                                                                                                  | `{}`                                 |
| `serviceAccount.name`                     | Service account to be used. If not set and `serviceAccount.create` is `true`, a name is generated using the full name template.                                             |                                      |
| `serviceAccount.automountToken`           | If `true`, mount the ServiceAccount token.                                                                                                                                  | `false`                              |
| `deployment`                              | If `true`, run as a `Deployment`, otherwise run as a `StatefulSet`.                                                                                                         | `true`                               |
| `podLabels`                               | Labels to add to the pod.                                                                                                                                                   | `{}`                                 |
| `podAnnotations`                          | Annotations to add to the pod.                                                                                                                                              | `{}`                                 |
| `podSecurityContext`                      | Security context for the pod.                                                                                                                                               | `{ fsGroup: 200 }`                   |
| `securityContext`                         | Security context for the _nexus3_ container.                                                                                                                                | `{}`                                 |
| `priorityClassName`                       | Priority class name to use.                                                                                                                                                 | `""`                                 |
| `livenessProbe`                           | The liveness probe.                                                                                                                                                         | See _values.yaml_                    |
| `readinessProbe`                          | The readiness probe.                                                                                                                                                        | See _values.yaml_                    |
| `service.type`                            | Service type.                                                                                                                                                               | `ClusterIP`                          |
| `service.clusterIP`                       | Service cluster IP.                                                                                                                                                         |                                      |
| `service.annotations`                     | Annotations to add to the service.                                                                                                                                          | `{}`                                 |
| `service.port`                            | Service port.                                                                                                                                                               | `8881`                               |
| `service.additionalPorts`                 | Additional ports exposed by the service and used by repository connectors.                                                                                                  |                                      |
| `metrics.enabled`                         | If `true`, metrics will be enabled (with anonymous access configured).                                                                                                      | `false`                              |
| `metrics.serviceMonitor.enabled`          | If `true`, create a _Prometheus_ service monitor.                                                                                                                           | `false`                              |
| `metrics.serviceMonitor.additionalLabels` | Additional labels to be set on the service monitor.                                                                                                                         | `{}`                                 |
| `metrics.serviceMonitor.endpointConfig`   | Additional endpoint configuration for the ServiceMonitor.                                                                                                                   | `{}`                                 |
| `metrics.serviceMonitor.interval`         | **DEPRECATED** _Prometheus_ scrape frequency, use `metrics.serviceMonitor.endpointConfig.interval` instead.                                                                 | `""`                                 |
| `ingress.enabled`                         | If `true`, create an ingress object.                                                                                                                                        | `false`                              |
| `ingress.annotations`                     | Ingress annotations.                                                                                                                                                        | `{}`                                 |
| `ingress.ingressClassName`                | Ingress class to use.                                                                                                                                                       | `""`                                 |
| `ingress.hosts`                           | Ingress hosts.                                                                                                                                                              | `[]`                                 |
| `ingress.tls`                             | Ingress TLS configuration                                                                                                                                                   | `[]`                                 |
| `persistence.enabled`                     | If `true`, create a PVC.                                                                                                                                                    | `false`                              |
| `persistence.annotations`                 | Annotations to add to the PVC.                                                                                                                                              | `{}`                                 |
| `persistence.existingClaim`               | Use an existing PVC to persist data.                                                                                                                                        |                                      |
| `persistence.accessMode`                  | Persistence access mode.                                                                                                                                                    | `ReadWriteOnce`                      |
| `persistence.storageClass`                | PVC storage class (use `-` for default).                                                                                                                                    | `standard`                           |
| `persistence.size`                        | Size of PVC to create.                                                                                                                                                      | `8Gi`                                |
| `extraVolumeMounts`                       | Additional volume mounts for the _nexus3_ container.                                                                                                                        | `[]`                                 |
| `resources`                               | Resource requests and limits for the _nexus3_ container.                                                                                                                    | `{}`                                 |
| `chownDataDir`                            | If the `chown` init container should be used.                                                                                                                               | `true`                               |
| `extraInitContainers`                     | Additional init containers for the pod.                                                                                                                                     | `[]`                                 |
| `extraVolumes`                            | Additional volumes.                                                                                                                                                         | `[]`                                 |
| `terminationGracePeriodSeconds`           | Termination grace period in seconds.                                                                                                                                        | `30`                                 |
| `nodeSelector`                            | Node labels for pod assignment.                                                                                                                                             | `{}`                                 |
| `affinity`                                | Affinity settings for pod assignment. If an explicit label selector is not provided for pod affinity or pod anti-affinity one will be created from the pod selector labels. | `{}`                                 |
| `topologySpreadConstraints`               | Topology spread constraints for pod assignment. If an explicit label selector is not provided one will be created from the pod selector labels.                             | `[]`                                 |
| `tolerations`                             | Tolerations for pod assignment.                                                                                                                                             | `[]`                                 |
| `caCerts.enabled`                         | If `true`, add provided CA certificates to the JVM cacerts key store.                                                                                                       | `false`                              |
| `caCerts.secret`                          | Secret containing the additional CA certificates.                                                                                                                           |                                      |
| `envVars.jvmMinHeapSize`                  | JVM min heap size (should match `jvmMaxHeapSize`).                                                                                                                          | `1024m`                              |
| `envVars.jvmMaxHeapSize`                  | JVM max heap size (should match `jvmMinHeapSize`).                                                                                                                          | `1024m`                              |
| `envVars.jvmAdditionalMemoryOptions`      | Additional JVM memory options.                                                                                                                                              | `-XX:MaxDirectMemorySize=2048m`      |
| `envVars.jvmAdditionalOptions`            | Additional JVM options.                                                                                                                                                     | `""`                                 |
| `env`                                     | Environment variables for the _nexus3_ container.                                                                                                                           |                                      |
| `logback.maxHistory`                      | Logback retention period in days.                                                                                                                                           | `30`                                 |
| `properties`                              | Additional _Nexus_ properties.                                                                                                                                              | `[nexus.scripts.allowCreation=true]` |
| `rootPassword.secret`                     | Secret to set the root password with.                                                                                                                                       |                                      |
| `rootPassword.key`                        | Key on the secret set in `config.rootPassword.secret`.                                                                                                                      | `password`                           |
| `config.enabled`                          | If `true`, automatically configure _Nexus_. This requires the `rootPassword` values to be set.                                                                              | `false`                              |
| `config.rootPassword.secret`              | **DEPRECATED** - Use `rootPassword.secret` instead; this has priority.                                                                                                      |                                      |
| `config.rootPassword.key`                 | **DEPRECATED** - Use `rootPassword.key` instead; this has priority.                                                                                                         |                                      |
| `config.anonymous.enabled`                | If `true`, allow anonymous access.                                                                                                                                          | `false`                              |
| `config.realms.enabled`                   | If `true`, realms should be configured.                                                                                                                                     | `false`                              |
| `config.realms.values`                    | Realm ids to enable, in priority order (see `values.yaml` for available realms).                                                                                            | `[]`                                 |
| `config.roles`                            | Roles to be configured (see `values.yaml` for structure).                                                                                                                   | `[]`                                 |
| `config.users`                            | Users to be configured (see `values.yaml` for structure).                                                                                                                   | `[]`                                 |
| `config.ldap.enabled`                     | If `true`, configure LDAP.                                                                                                                                                  | `false`                              |
| `config.ldap.name`                        | Unique name for the LDAP configuration.                                                                                                                                     |                                      |
| `config.ldap.protocol`                    | LDAP protocol, either `ldaps` or `ldap`.                                                                                                                                    | `ldaps`                              |
| `config.ldap.useTrustStore`               | Use _Nexus_ trust store for certificate validation.                                                                                                                         | `true`                               |
| `config.ldap.connectionTimeoutSeconds`    | LDAP connection timeout.                                                                                                                                                    | `30`                                 |
| `config.ldap.connectionRetryDelaySeconds` | LDAP connection retry delay.                                                                                                                                                | `300`                                |
| `config.ldap.maxIncidentsCount`           | LDAP connection max incidents.                                                                                                                                              | `3`                                  |
| `config.ldap.host`                        | LDAP host.                                                                                                                                                                  |                                      |
| `config.ldap.port`                        | LDAP port.                                                                                                                                                                  | `636`                                |
| `config.ldap.authScheme`                  | LDAP authentication schema.                                                                                                                                                 | `simple`                             |
| `config.ldap.authUsername`                | Username or DN (Distinguished Name) of an LDAP user, used to connect to the LDAP server.                                                                                    |                                      |
| `config.ldap.authPassword.secret`         | Secret containing the password to connect to the LDAP server.                                                                                                               |                                      |
| `config.ldap.authPassword.key`            | The key on the secret containing the password to connect to the LDAP server.                                                                                                |                                      |
| `config.ldap.authRealm`                   | LDAP authentication realm.                                                                                                                                                  |                                      |
| `config.ldap.searchBase`                  | LDAP search base.                                                                                                                                                           |                                      |
| `config.ldap.userBaseDn`                  | LDAP user base, relative to the search base.                                                                                                                                |                                      |
| `config.ldap.userSubtree`                 | If `true`, LDAP users in trees below the user base are valid.                                                                                                               | `false`                              |
| `config.ldap.userObjectClass`             | LDAP object class for users.                                                                                                                                                | `user`                               |
| `config.ldap.userLdapFilter`              | LDAP user filter.                                                                                                                                                           |                                      |
| `config.ldap.userIdAttribute`             | LDAP user id attribute.                                                                                                                                                     | `sAMAccountName`                     |
| `config.ldap.userRealNameAttribute`       | LDAP user real name attribute.                                                                                                                                              | `cn`                                 |
| `config.ldap.userEmailAddressAttribute`   | LDAP user email address attribute.                                                                                                                                          | `email`                              |
| `config.ldap.userPasswordAttribute`       | LDAP user password attribute.                                                                                                                                               |                                      |
| `config.ldap.ldapGroupsAsRoles`           | If `true`, LDAP user groups will be treated as a _Nexus_ role.                                                                                                              | `false`                              |
| `config.ldap.groupType`                   | LDAP group type, either `dynamic` or `static`.                                                                                                                              | `dynamic`                            |
| `config.ldap.userMemberOfAttribute`       | LDAP user member of attribute, required if `groupType` is `dynamic`.                                                                                                        | `memberOf`                           |
| `config.ldap.groupBaseDn`                 | LDAP group base, required if `groupType` is `static`.                                                                                                                       |                                      |
| `config.ldap.groupSubtree`                | If `true`, LDAP groups in trees below the group base are valid (only used if `groupType` is `static`).                                                                      | `false`                              |
| `config.ldap.groupObjectClass`            | LDAP group object class, required if `groupType` is `static`.                                                                                                               |                                      |
| `config.ldap.groupIdAttribute`            | LDAP group id attribute, required if `groupType` is `static`.                                                                                                               |                                      |
| `config.ldap.groupMemberAttribute`        | LDAP group member attribute, required if `groupType` is `static`.                                                                                                           |                                      |
| `config.ldap.groupMemberFormat`           | LDAP group member format, required if `groupType` is `static`.                                                                                                              |                                      |
| `config.blobStores`                       | Blob stores to be configured (see `values.yaml` for structure).                                                                                                             | `[]`                                 |
| `config.cleanup`                          | Cleanup policies to be configured (see `values.yaml` for structure).                                                                                                        | `[]`                                 |
| `config.repoCredentials.enabled`          | If `true`, use the given secret to provide repo credentials.                                                                                                                | `false`                              |
| `config.repoCredentials.secret`           | Secret containing repo credentials, where the key should be the repo name and the value the password.                                                                       | `[]`                                 |
| `config.repos`                            | Repos to be configured (see `values.yaml` for structure).                                                                                                                   | `[]`                                 |
| `config.tasks`                            | Tasks to be configured (see `values.yaml` for structure).                                                                                                                   | `[]`                                 |
| `testResources`                           | If `true`, create resources required for testing and enable the resources to be used by the test hook.                                                                      | `false`                              |
